<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Admin Page</title>

    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/css/dataTables.bootstrap4.min.css"
        integrity="sha512-PT0RvABaDhDQugEbpNMwgYBCnGCiTZMh9yOzUsJHDgl/dMhD9yjHAwoumnUk3JydV3QTcIkNDuN40CJxik5+WQ=="
        crossorigin="anonymous" />
    <!-- Bootstrap core CSS -->
    <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.23/css/dataTables.bootstrap4.min.css">

    <!-- Custom styles for this template -->
    <link href="../css/simple-sidebar.css" rel="stylesheet">

    <style>
        * {
            background-image: url(../pic/26.svg);
            background-repeat: no-repeat;
            background-size: cover;
            background-attachment: fixed;
        }

        .ul {
            display: inline-flex;
            list-style-type: none;
            margin: 0;
            padding: 0;

        }

        a {
            color: white;
        }

        span {
            text-align: right;
        }

        h1 {
            color: purple;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.23/css/dataTables.jqueryui.min.css">
</head>

<body>

    <div class="d-flex" id="wrapper">

        <!-- Sidebar -->
        <div class="bg-light border-right" id="sidebar-wrapper">
            <div class="sidebar-heading">Hello • Ěšⓡää Šäⓜï •</div>
            <div class="list-group list-group-flush">
                <p class="list-group-item list-group-item-action " id="showEmployeeTable"><a href="#">Employees</a></p>
                <p class="list-group-item list-group-item-action" id="showLateReport"><a href="#">Late Report</a></p>
                <p class="list-group-item list-group-item-action" id="showExcReport"><a href="#">Excuse Report</a></p>
                <p class="list-group-item list-group-item-action" id="showEmpBreif"><a href="#">Employee Brief</a></p>
                <p class="list-group-item list-group-item-action"><a href="home.html">Exit</a></p>
            </div>

        </div>
        <!-- /#sidebar-wrapper -->
        <!-- Page Content -->
        <div id="page-content-wrapper">

            <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
                <button class="btn btn-primary" id="menu-toggle">^-^ Press Me ^-^</button>
                <div class="ml-auto">
                    <h1>Better Builder Group</p>
                </div>
            </nav>

            <div class="container">
                <div class="card">
                    <div class="card-body" id="wraper2">
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <!-- /#page-content-wrapper -->
    </div>
    <!-- /#wrapper -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"
        integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg=="
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/js/jquery.dataTables.min.js"
        integrity="sha512-BkpSL20WETFylMrcirBahHfSnY++H2O1W+UnEEO4yNIl+jI2+zowyoGJpbtk6bx97fBXf++WJHSSK2MV4ghPcg=="
        crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.10.23/js/dataTables.bootstrap4.min.js"></script>

    <!-- Bootstrap core JavaScript -->
    <script src="../vendor/jquery/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js
    "></script>
    <!-- Menu Toggle Script -->
    <!-- <script src="../js/admin.js"></script> -->

    <script>
        //side nav bar
        $("#menu-toggle").click(function (e) {
            e.preventDefault();
            $("#wrapper").toggleClass("toggled");
        });

        //اول جدول
        $('#showEmployeeTable').on('click', () => {
            var header = ` <table id="employeeTable" width="100%" border="2px solid black;" class="table text-white">
                <thead>
                    <th>User Code</th>
                    <th>Frist Name</th>
                    <th>Last Name</th>
                    <th>Address</th>
                    <th>E-mail</th>
                    <th>Age</th>
                </thead>
            </table>`;

            $('#wraper2').empty();
            $('#wraper2').append(header);
            $("#employeeTable").DataTable({
                ajax: {
                    url: "../json/_json_emp.json",
                    type: "GET",
                    error: function (e) { },
                    dataSrc: function (d) {
                        return d;
                    }
                },
                columns: [
                    { data: "randomCode" },
                    { data: "fname" },
                    { data: "lname" },
                    { data: "ads" },
                    { data: "mail" },
                    { data: "age" },
                ]
            });
        });
        //تانى جدول
        $('#showLateReport').on('click', () => {
            var header = ` <table id="employeeTable" width="100%" border="2px solid black;" class="table text-white">
                <thead>
                    <th>randomCode</th>
                    <th>Frist Name</th>
                    <th>Late Days</th>
                    <th>Attend Days</th>
                </thead>
            </table>`;

            $('#wraper2').empty();
            $('#wraper2').append(header);
            $("#employeeTable").DataTable({
                ajax: {
                    url: "../json/_json_emp.json",
                    type: "GET",
                    error: function (e) { },
                    dataSrc: function (d) {
                        return d;
                    }
                },
                columns: [
                    { data: "randomCode" },
                    { data: "fname" },
                    { data: "late" },
                    { data: "attend" }
                ]
            });
        });
        //تالت جدول
        $('#showExcReport').on('click', () => {
            var header = ` <table id="employeeTable" width="100%" border="2px solid black;" class="table text-white">
                <thead>
                    <th>randomCode</th>
                    <th>Frist Name</th>
                    <th>Absent Days</th>
                    <th>Excuses</th>
                </thead>
            </table>`;

            $('#wraper2').empty();
            $('#wraper2').append(header);
            $("#employeeTable").DataTable({
                ajax: {
                    url: "../json/_json_emp.json",
                    type: "GET",
                    error: function (e) { },
                    dataSrc: function (d) {
                        return d;
                    }
                },
                columns: [
                    { data: "randomCode" },
                    { data: "fname" },
                    { data: "absent" },
                    { data: "exc" }
                ]
            });
        });
        var userData = JSON.parse(localStorage.getItem('user'));

        let _url = "../json/_json_emp.json";
        let arr = [];
        $.ajax({
            url: _url,
            type: "get",
            success: function (data) {

                arr = data;
                $('#wraper2').on('click', '#add', function () {

                    let uid = $(this).parent().parent().children().first().html();
                    let obj = userData.find((e) => e.mail == uid);
                    console.table(userData);
                    index = userData.findIndex((e) => {
                        return e.mail == uid;
                    });

                    console.log(obj);
                    arr.push(obj);

                    userData.splice(index, 1);
                    localStorage.setItem("user", JSON.stringify(userData));
                    console.log(arr);
                    SaveData();
                });
            },
            error: function err() {
                console.log("Faild sorry!!");
            }
        });
        //اخر جدول
        $('#showEmpBreif').on('click', () => {

            drawData();

            var table = $('#employeeTable').DataTable();
            console.log(table)
            $('#wraper2').on('click', 'tr', function () {
                if ($(this).hasClass('selected')) {

                    // console.log($(this).parent().parent().first().val())
                    $(this).removeClass('selected');
                } else {
                    table.$('tr.selected').removeClass('selected');
                    $(this).addClass('selected');
                }
            });


            $('#wraper2').on('click', '#reject', function () {
                var del = table.row('.selected');
                let uids = $(this).parent().parent().children().first().html();
                index = userData.findIndex((e) => {
                    return e.mail == uids;
                });
                userData.splice(index, 1);
                localStorage.setItem("user", JSON.stringify(userData));
                del.remove().draw(false);

            });


        });

        function drawData() {
            var header = ` <table id="employeeTable"  border="2px solid black;" class="table text-white">
                <thead>
                    <th>E-mail</th>
                    <th>Frist Name</th>
                    <th>Last Name</th>                   
                    <th>User Name</th>
                    <th>Address</th>
                    <th>Age</th>
                    <th>Password</th>
                    <th>New User</th>
                </thead>
            </table>`;
            $('#wraper2').empty();
            $('#wraper2').append(header);
            $("#employeeTable").DataTable({
                data: userData,
                columns: [
                    { data: "mail" },
                    { data: "fname" },
                    { data: "lname" },
                    { data: "usertxtinput" },
                    { data: "ads" },
                    { data: "age" },
                    { data: "userpassinput" },
                    {
                        defaultContent: `<button id="add" class="btn btn-success text-white">Add</button>\
                        <button id="reject" class="btn btn-danger text-white">Reject</button>`
                    }
                ]

            });

        }

        function SaveData() {
            console.log(arr);
                            //1-creat blob
            var _StoreData = new Blob([JSON.stringify(arr)], { type: "appliction/json" });
                            //2-create anchor
            var Linkelement = document.createElement("a");
            Linkelement.href = window.webkitURL.createObjectURL(_StoreData);
            Linkelement.setAttribute("download", "../json/emp.json");
                            //append link
            document.body.appendChild(Linkelement);
                            //click fire
            Linkelement.click();
            document.body.removeChild(Linkelement);
        }
    </script>

</body>

</html>